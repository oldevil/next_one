{% load staticfiles %}
<head>
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="shortcut icon" sizes="128x128" href="{% static '/img/favicon.png' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://apps.bdimg.com/libs/jquerymobile/1.4.5/jquery.mobile-1.4.5.min.css">
    <script src="http://apps.bdimg.com/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://apps.bdimg.com/libs/jquerymobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <title>Next One</title>
</head>

<body>
<div data-role="page">
    <div data-role="header" data-position="fixed">
        <h1>Next One</h1>
    </div>
    <div data-role="main" class="ui-content">
        <ul data-role="listview" data-inset="true">
            {% for room in rooms %}
                {% if room.get_next_patient %}
                    <li>
                        <a href="{% url 'room:room_detail' room.id %}" data-ajax="false">
                            <h1>OR {{ room.number }}</h1>
                            <p>
                                {% if room.get_current_patient %}
                                    当前患者：{{ room.get_current_patient.name }}<br>
                                    术者：{{ room.get_current_patient.surgeon.name }}<br>
                                    一助：{{ room.get_current_patient.assistant.name }}<br>
                                    入室时间：{{ room.get_current_patient.entry_time }}<br>
                                {% else %}
                                    Let's get started!<br>
                                {% endif %}
                                Next One：{{ room.get_next_patient.name }}
                            </p>
                        </a>
                        <a href="javascript:void(0);" onclick="patient_get_in({{ room.id }}, {{ room.get_next_patient.id }})">入室</a>
                    </li>
                    {% else %}
                    <li data-icon="false">
                        <a href="{% url 'room:room_detail' room.id %}" data-ajax="false">
                            <h1>OR {{ room.number }}</h1>
                            <p>
                                {% if room.get_current_patient %}
                                    当前患者：{{ room.get_current_patient.name }}<br>
                                    术者：{{ room.get_current_patient.surgeon.name }}<br>
                                    一助：{{ room.get_current_patient.assistant.name }}<br>
                                    入室时间：{{ room.get_current_patient.entry_time }}<br>
                                    Next One：Well done!
                                {% else %}
                                    今日打烊<br>
                                {% endif %}
                            </p>
                        </a>
                    </li>
                {% endif %}
            {% endfor%}
        </ul>
    </div>
    <div data-role="footer" data-position="fixed" style="text-align:center;">
        <a href="{% url 'room:patient_create' %}" data-ajax="false">添加患者</a>
        <a href="{% url 'room:surgeon_index' %}" data-ajax="false">术者</a>
        <a href="{% url 'room:assistant_index' %}" data-ajax="false">一助</a>
    </div>
</div>
</body>

<script>
    function patient_get_in(room_id, patient_id) {
        jQuery.ajax({
            url: "{% url 'room:patient_get_in' %}",
            type: 'POST',
            dataType: 'text',
            data: {
                room_id: room_id,
                patient_id: patient_id,
            },
            success: function () {
                location.reload();
            },
            error: function (data) {
                alert(data.responseText);
                location.reload();
            }
        });
    }
</script>